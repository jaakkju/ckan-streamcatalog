{% ckan_extends %}

{% import 'macros/form.html' as form -%}

{% block package_resources %}
  
  Data provider - connect to: {{ pkg.id }}

  {# snippet "package/snippets/resources_list.html", pkg=pkg, resources=pkg.resources #}
  {% set susbcriptions = h.streamcatalog_getAllSubscriptions(pkg.id) %}
  {% if susbcriptions %}
    <h3>Subscriptions</h3>
    <table class="table table-striped table-bordered table-condensed">
      <tr><th>user</th><th>url</th><th>state</th></tr>
      {% for susbcription in susbcriptions %}
      <tr>
        <td>{{ susbcription.User.name }}</td>
        <td>{{ susbcription.Resource.url }}</td>
        <td>
          {{ susbcription.Resource.state }}
          {% if susbcription.Resource.state == 'active' %}
            {% if h.check_access('resource_delete', {'id': susbcription.Resource.id}) -%}
              {% set locale = h.dump_json({'content': _('Are you sure you want to delete this resource?')}) -%}
              <a class="btn btn-danger pull-left" href="{% url_for controller='package', action='resource_delete', resource_id=susbcription.Resource.id, id=pkg.id %}" data-module="confirm-action" data-module-i18n="{{ locale }}">{{ _('Delete') }}</a>
            {% endif -%}
          {% endif -%}
        </td>
      </tr>
      {% endfor %}
    </table>

    {% set action = form_action or h.url_for(controller='package', action='new_resource', id=pkg.name) -%}
    <form class="dataset-form dataset-resource-form form-horizontal" method="post" action="{{ action }}" data-module="basic-form resource-form">
      <input name="id" value="" type="hidden"/>
      {{ form.input('url', id='field-url', label=_('Url'), placeholder=_('eg. http://example.com/gold-prices-jan-2011.json'), value='', error={}, classes=['control-full', 'control-large']) }}
      <button class="btn btn-primary" name="save" value="go-dataset-complete" type="submit" style="margin-top: -102px;">{{ _('Add') }}</button>
    </form>
  {% endif %}
{% endblock %}