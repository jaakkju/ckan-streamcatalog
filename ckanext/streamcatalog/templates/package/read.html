{% ckan_extends %}

{% import 'macros/form.html' as form -%}

{% block package_resources %}
  
  Data provider - connect to: {{ pkg.id }}

  {# snippet "package/snippets/resources_list.html", pkg=pkg, resources=pkg.resources #}
  
  {% set susbcriptions = h.streamcatalog_getAllSubscriptions(pkg.id) %}
  {% snippet "package/snippets/subscriptions_list.html", pkg=pkg, susbcriptions=susbcriptions, state='active' %}

  {% if susbcriptions %}

    {% if h.check_access('resource_create') -%}
      <fieldset style="border: 1px solid #DDD; max-height: 60px;">
        {% set action = form_action or h.url_for(controller='package', action='new_resource', id=pkg.name) -%}
        <form class="dataset-form dataset-resource-form form-horizontal" method="post" action="{{ action }}" data-module="basic-form resource-form" style="padding: 10px 10px;">
          <input name="id" value="" type="hidden"/>
          {{ form.input('url', id='field-url', label=_('Url'), placeholder=_('eg. http://example.com/gold-prices-jan-2011.json'), value='', error={}, classes=['control-full', 'control-large']) }}
          <div style="clear: both"></div>
          <button class="btn btn-primary" name="save" value="go-dataset-complete" type="submit" style="margin-top: -102px;">{{ _('Add') }}</button>
        </form>
      </fieldset>
    {% endif -%}

  {% endif %}

  {% snippet "package/snippets/subscriptions_list.html", pkg=pkg, susbcriptions=susbcriptions, state='deleted' %}

  {% if c.userobj and c.userobj.sysadmin -%}
    <form class="dataset-form dataset-resource-form form-horizontal" method="post" action="/dataset/{{ pkg.name }}/publish" data-module="basic-form resource-form">
      {{ form.textarea('message', id='field-message', label=_('Message'), placeholder='', value='', error={}, classes=['control-full', 'control-large']) }}
      <button class="btn btn-primary" name="save" value="go-dataset-complete" type="submit" style="">{{ _('Send') }}</button>
    </form>
  {% endif -%}

{% endblock %}